# QML

## QML Article Link

-  [Integrating C++ with QML](https://www.youtube.com/watch?v=ragZPvRe6Pk/).
-  [QML教程 ](https://www.bilibili.com/video/BV13X4y1y72W/).
-  [Qt Quick tutorial](https://zetcode.com/gui/qtquick/).
-  [qml-book](https://www.qt.io/product/qt6/qml-book/).
-  [QML6(Qt Quick)开发教程（完整版）](https://www.bilibili.com/video/BV1j14y1e7Hf/).
-  [Qt QML Tutorial](https://www.youtube.com/watch?v=2c0fpk_aObo&list=PLxkHKJE0D3pCT9qKzQ6eFOZ0gdXKxPaDU/).
-  [How to integrate C++ and QML](https://www.youtube.com/watch?v=rsBQgR_pd48/).
-  [Qt Quick Examples - Animation](http://www.bim-times.com/qt/Qt-5.11.1/qtquick/qtquick-animation-example.html).
-  [Qt QML complete tutorial](https://www.bilibili.com/video/BV1Nx4y1D7dw/).
-  [QT开发基础教程 QML ListView 列表视图简易介绍](https://www.bilibili.com/video/BV14p421y717/).
-  [C++ cmake工程引入qt6和Quick 教程](https://zhuanlan.zhihu.com/p/661282870/).


## QML Book

-  [qmlbook.github.io](https://qmlbook.github.io/).


## Example

Simple.qmlproject
```
/* File generated by Qt Creator */

import QmlProject 1.1

Project {
    mainFile: "Simple.qml"

    /* Include .qml, .js, and image files from current directory and subdirectories */
    QmlFiles {
        directory: "."
    }
    JavaScriptFiles {
        directory: "."
    }
    ImageFiles {
        directory: "."
    }
    /* List of plugin directories passed to QML runtime */
    // importPaths: [ "asset_imports" ]
}
```

Simple.qml
```qml
import QtQuick

Window {
    width: 640
    height: 480
    visible: true
    title: qsTr("Hello World")
}
```

### Hello World
```qml
import QtQuick

Text {
    text: "Hello World!"
}
```

### command line run
```
c:/local/Qt/6.7.0/msvc2019_64/bin/qml.exe ./HelloWorld.qml 
```

typical results:
```
PS D:\work\qt_2024_work\ModernQt\codes\QML\HelloWorld\01> c:/local/Qt/6.7.0/msvc2019_64/bin/qml.exe ./HelloWorld.qml
```




### QML Image: Cannot open - CMake qrc

```cmake
set(CMAKE_AUTORCC ON)
```

### glsl Shader

```
set path=D:\Qt\Tools\QtDesignStudio\qt6_design_studio_reduced_version\bin
qsb --glsl 100es,120,150 --hlsl 50 --msl 12    -o default.frag.qsb default.frag
qsb --glsl 100es,120,150 --hlsl 50 --msl 12 -b -o default.vert.qsb default.vert
```

my pc
```
set path=c:\local\Qt\Tools\QtDesignStudio\qt6_design_studio_reduced_version\bin\
qsb --glsl 100es,120,150 --hlsl 50 --msl 12    -o default.frag.qsb default.frag
qsb --glsl 100es,120,150 --hlsl 50 --msl 12 -b -o default.vert.qsb default.vert
```

default.frag
```cpp
#version 440

layout(location=0) in vec2 qt_TexCoord0;
layout(location=0) out vec4 fragColor;

layout(std140, binding=0) uniform buf {
    mat4 qt_Matrix;
	float qt_Opacity;
} ubuf;

layout(binding=1) uniform sampler2D source;

void main(){
    fragColor = texture(source, qt_TexCoord0) * ubuf.qt_Opacity;
}
```

default.vert
```cpp
#version 440

layout(location=0) in vec4 qt_Vertex;
layout(location=1) in vec2 qt_MultiTexCoord0;

layout(location=0) out vec2 qt_TexCoord0;

layout(std140, binding=0) uniform buf {
    mat4 qt_Matrix;
	float qt_Opacity;
} ubuf;

out gl_PerVertex {
    vec4 gl_Position;
};

void main(){
    qt_TexCoord0 = qt_MultiTexCoord0;
    gl_Position = ubuf.qt_Matrix * qt_Vertex;
}

```

frag example
```cpp
#version 440

layout(location=0) in vec2 qt_TexCoord0;
layout(location=0) out vec4 fragColor;

layout(std140, binding=0) uniform buf {
    mat4 qt_Matrix;
	float qt_Opacity;
} ubuf;

layout(binding=1) uniform sampler2D source;

void main(){
    vec4 tex = texture(source, qt_TexCoord0);
    fragColor = vec4(vec3(dot(tex.rgb,vec3(0.344,0.5,0.156))),tex.a) * ubuf.qt_Opacity;
}

```

red.frag
```cpp
#version 440

layout(location=0) in vec2 qt_TexCoord0;
layout(location=0) out vec4 fragColor;

layout(std140, binding=0) uniform buf {
    mat4 qt_Matrix;
	float qt_Opacity;
} ubuf;

layout(binding=1) uniform sampler2D source;

void main(){
    fragColor = vec4(1.0,0.0,0.0,1.0);
}

```

frag example
```cpp
#version 440

layout(location=0) in vec2 qt_TexCoord0;
layout(location=0) out vec4 fragColor;

layout(std140, binding=0) uniform buf {
    mat4 qt_Matrix;
	float qt_Opacity;
	
	float frequency;
	float amplitude;
	float time;
} ubuf;

layout(binding=1) uniform sampler2D source;

void main(){
    vec2 pulse = sin(ubuf.time - ubuf.frequency * qt_TexCoord0);
	vec2 coord = qt_TexCoord0 + ubuf.amplitude * vec2(pulse.x,-pulse.x);
    fragColor = texture(source, coord) * ubuf.qt_Opacity;
}

```

frag example
```cpp
#version 440

layout(location=0) in vec2 qt_TexCoord0;
layout(location=0) out vec4 fragColor;

layout(std140, binding=0) uniform buf {
    mat4 qt_Matrix;
	float qt_Opacity;
	
	float frequency;
	float amplitude;
	float time;
} ubuf;

layout(binding=1) uniform sampler2D source;

void main(){
    vec2 pulse = sin(ubuf.time - ubuf.frequency * qt_TexCoord0);
	vec2 coord = qt_TexCoord0 + ubuf.amplitude * vec2(pulse.x,-pulse.x);
    fragColor = texture(source, coord) * ubuf.qt_Opacity;
}

```

vertex.vert example
```cpp
#version 440

layout(location=0) in vec4 qt_Vertex;
layout(location=1) in vec2 qt_MultiTexCoord0;

layout(location=0) out vec2 qt_TexCoord0;

layout(std140, binding=0) uniform buf {
    mat4 qt_Matrix;
	float qt_Opacity;
	
	float minimize;
	float width;
	float height;
	float bend;
	float side;
} ubuf;

out gl_PerVertex {
    vec4 gl_Position;
};

void main(){
    qt_TexCoord0 = qt_MultiTexCoord0;
	vec4 pos = qt_Vertex;
	pos.y = mix(qt_Vertex.y, ubuf.height, ubuf.minimize);
	pos.x = mix(qt_Vertex.x, ubuf.width, ubuf.minimize);
	float t = pos.y / ubuf.height;
	t = ( 3.0 - 2.0 * t ) * t * t;
	//pos.x = mix(qt_Vertex.x, ubuf.side * ubuf.width, t * ubuf.bend);
    gl_Position = ubuf.qt_Matrix * pos;
}
```

sprite.vert example
```cpp
#version 440

layout(location=0) in vec4 qt_Vertex;
layout(location=1) in vec2 qt_MultiTexCoord0;

layout(location=0) out vec2 qt_TexCoord0;

layout(std140, binding=0) uniform buf {
    mat4 qt_Matrix;
	float qt_Opacity;
	
	float minimize;
	float width;
	float height;
	float bend;
	float side;
} ubuf;

out gl_PerVertex {
    vec4 gl_Position;
};

void main(){
    qt_TexCoord0 = qt_MultiTexCoord0;
	vec4 pos = qt_Vertex;
	pos.y = mix(qt_Vertex.y, ubuf.height, ubuf.minimize);
	//pos.x = mix(qt_Vertex.x, ubuf.width, ubuf.minimize);
	float t = pos.y / ubuf.height;
	t = ( 3.0 - 2.0 * t ) * t * t;
	pos.x = mix(qt_Vertex.x, ubuf.side * ubuf.width, t * ubuf.bend);
    gl_Position = ubuf.qt_Matrix * pos;
}
```


### default picture saved position

```
c:\Users\eric\Pictures\
```


### balsamui.exe location
```
c:\local\Qt\Tools\QtDesignStudio\qt6_design_studio_reduced_version\bin\balsamui.exe
```

### QML_XHR_ALLOW_FILE_READ

run.bat
```
set QML_XHR_ALLOW_FILE_READ=1
"c:\local\Qt\Tools\QtCreator\bin\qtcreator.exe"
```

### venv

```
py.exe -m venv venv
venv\Scripts\activate
```

results
```
PS D:\work\qt_2024_work\ModernQt\codes\QML\restapi\01a\restapi\restservice> venv\Scripts\activate
(venv) PS D:\work\qt_2024_work\ModernQt\codes\QML\restapi\01a\restapi\restservice>
```

### Flask

```
https://flask.palletsprojects.com
py.exe -m venv venv
venv\Scripts\activate
```

### Install Flask

```
pip install Flask
```

### upgrade pip

```
python.exe -m pip install --upgrade pip
py.exe -m pip install --upgrade pip
```

### run flask

```
flask --app server run
```

### json load problem

```python
json.load(file('colors.json', 'r'))
```

error
```
colors = json.load(file('colors.json', 'r'))
                       ^^^^
NameError: name 'file' is not defined. Did you mean: 'filter'?
```

```python
# Opening JSON file
f = open('data.json')
 
# returns JSON object as 
# a dictionary
data = json.load(f)
```

### OfflineStorage
```
"C:\\Users\\eric\\AppData\\Roaming\\applocalstorage\\QML\\OfflineStorage\\Databases\\d41d8cd98f00b204e9800998ecf8427e"
```

### plugin

default
```
Object class-name: MyItem
URI: com.mycompany.qmlcomponents
```

simple example
```
Object class-name: CppModel
URI: com.eric.cppModel
```

### cmake qtquick

```
cmake -DCMAKE_PREFIX_PATH=c:\local\Qt\6.7.0\msvc2019_64\lib\cmake\
```