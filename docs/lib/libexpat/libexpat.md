# libexpat


## Link

- [libexpat](https://github.com/libexpat/libexpat).


## git clone git@github.com:libexpat/libexpat.git
```
PS D:\work\libexpat_work> git clone git@github.com:libexpat/libexpat.git
Cloning into 'libexpat'...
remote: Enumerating objects: 23636, done.
remote: Counting objects: 100% (3505/3505), done.
remote: Compressing objects: 100% (308/308), done.
remote: Total 23636 (delta 3294), reused 3203 (delta 3197), pack-reused 20131 (from 4)
Receiving objects: 100% (23636/23636), 16.23 MiB | 4.41 MiB/s, done.
Resolving deltas: 100% (17692/17692), done.
```

```
SQLite3_INCLUDE_DIR c:/dev/sqlite3/include/
SQLite3_LIBRARY c:/dev/sqlite3/lib/libsqlite3.lib
```


```
PS C:\Users\eric> Get-ChildItem Env:

Name                           Value
----                           -----
adios2_DIR                     c:\dev\ADIOS2\lib\cmake\adios2\
ADVISOR_2025_DIR               C:\Program Files (x86)\Intel\oneAPI\advisor\2025.0
Alembic_DIR                    c:\dev\Alembic\lib\cmake\Alembic\
ALLUSERSPROFILE                C:\ProgramData
anari_DIR                      c:\dev\anari-sdk\lib\cmake\
APPDATA                        C:\Users\eric\AppData\Roaming
blosc_ROOT                     c:\dev\blosc\
BOOST_DIR                      c:\dev\boost_1_88_0\stage\lib\cmake\Boost-1.88.0\
ChocolateyInstall              C:\ProgramData\chocolatey
ChocolateyLastPathUpdate       133545316565748845
CommonProgramFiles             C:\Program Files\Common Files
CommonProgramFiles(x86)        C:\Program Files (x86)\Common Files
CommonProgramW6432             C:\Program Files\Common Files
COMPUTERNAME                   DELL
ComSpec                        C:\WINDOWS\system32\cmd.exe
CUDA_PATH                      C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v12.5
CUDA_PATH_V12_5                C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v12.5
CURL_DIR                       c:\dev\CURL\lib\cmake\CURL\
DriverData                     C:\Windows\System32\Drivers\DriverData
EFC_2148_1592913036            1
expat_DIR                      c:\dev\expat\lib\cmake\expat-2.7.1\
FFMPEG_ROOT                    c:\msys64\usr\local\ffmpeg\
FreeGLUT_DIR                   c:\dev\freeglut\lib\cmake\FreeGLUT\
GDAL_DIR                       c:\dev\gdal
GeoTIFF_DIR                    c:\dev\GeoTIFF\cmake\
glad_DIR                       c:/dev/glad/lib/cmake/glad
GLEW_DIR                       c:\dev\glew\lib\cmake\glew\
GLFW3_DIR                      c:\dev\GLFW\lib\cmake\glfw3\
HDF5_DIR                       c:/dev/HDF_Group/HDF5/1.14.6/cmake/
HOMEDRIVE                      C:
HOMEPATH                       \Users\eric
IFORT_COMPILER25               C:\Program Files (x86)\Intel\oneAPI\compiler\2025.0\
Imath_DIR                      c:\dev\Imath\lib\cmake\Imath\
INCLUDE                        c:\dev\icu\include;
jsoncpp_DIR                    c:\dev\jsoncpp\lib\cmake\jsoncpp\
LIB                            c:\dev\icu\lib64;
libLAS_DIR                     c:\dev\libLAS\cmake\
LOCALAPPDATA                   C:\Users\eric\AppData\Local
LOGONSERVER                    \\DELL
MOZ_PLUGIN_PATH                C:\Program Files (x86)\Foxit Software\Foxit PDF Reader\plugins\
MSMPI_BENCHMARKS               C:\Program Files\Microsoft MPI\Benchmarks\
MSMPI_BIN                      C:\Program Files\Microsoft MPI\Bin\
MSMPI_INC                      C:\Program Files (x86)\Microsoft SDKs\MPI\Include\
MSMPI_LIB32                    C:\Program Files (x86)\Microsoft SDKs\MPI\Lib\x86\
MSMPI_LIB64                    C:\Program Files (x86)\Microsoft SDKs\MPI\Lib\x64\
mypath                         c:\dev\VTK_debug\bin\;c:\dev\HDF_Group\HDF5\1.14.6\bin\;c:\dev\VTK\bin\;c:\dev\glew\bin…
nlohmann_json_DIR              c:\dev\nlohmann_json\share\cmake\
NUMBER_OF_PROCESSORS           16
NVTOOLSEXT_PATH                C:\Program Files\NVIDIA Corporation\NvToolsExt\
OneDrive                       C:\Users\eric\OneDrive
OneDriveConsumer               C:\Users\eric\OneDrive
OpenBLAS_DIR                   c:\msys64\usr\local\OpenBLAS\lib\cmake\openblas\
OpenCASCADE_DIR                c:\dev\OCCT\cmake\
OPENTURNS_DIR                  c:\dev\openturns\lib\cmake\openturns\
OpenVDB_DIR                    c:\dev\OpenVDB\lib\cmake\OpenVDB\
OPENVDB_ROOT                   c:\dev\OpenVDB\
OpenVR_ROOT                    c:\dev\openvr\
OpenXR_DIR                     c:\dev\OPENXR\cmake\
OpenXR_ROOT                    c:\dev\OPENXR\
OS                             Windows_NT
ospray_DIR                     c:\dev\Intel\OSPRay v2\lib\cmake\ospray-2.10.0\
Path                           C:\Program Files\PowerShell\7;C:\dev\VulkanSDK\1.4.313.0\Bin;C:\Program Files\Microsoft…
PATHEXT                        .COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.CPL
PostgreSQL_ROOT                c:\Program Files\PostgreSQL\17\
POWERSHELL_DISTRIBUTION_CHANN… MSI:Windows 10 Pro
PROCESSOR_ARCHITECTURE         AMD64
PROCESSOR_IDENTIFIER           Intel64 Family 6 Model 165 Stepping 5, GenuineIntel
PROCESSOR_LEVEL                6
PROCESSOR_REVISION             a505
ProgramData                    C:\ProgramData
ProgramFiles                   C:\Program Files
ProgramFiles(x86)              C:\Program Files (x86)
ProgramW6432                   C:\Program Files
PROJ_DIR                       c:\dev\PROJ\lib\cmake\proj\
PSModulePath                   C:\Users\eric\Documents\PowerShell\Modules;C:\Program Files\PowerShell\Modules;c:\progr…
PUBLIC                         C:\Users\Public
QT_DIR                         c:\local\Qt\6.9.0\msvc2022_64\lib\cmake\
Qt6_DIR                        c:\local\Qt\6.9.0\msvc2022_64\lib\cmake\
QtNodes_DIR                    c:\dev\QtNodesLibrary\lib\cmake\QtNodes\
SDL3_DIR                       c:\dev\SDL3\cmake\
SESSIONNAME                    Console
SystemDrive                    C:
SystemRoot                     C:\WINDOWS
Tbb_DIR                        c:\Program Files (x86)\Intel\oneAPI\tbb\latest\lib\cmake\tbb\
TBB_ROOT                       c:\Program Files (x86)\Intel\oneAPI\tbb\latest\
TEMP                           C:\Users\eric\AppData\Local\Temp
TIFF_DIR                       c:\dev\tiff\lib\cmake\tiff\
TMP                            C:\Users\eric\AppData\Local\Temp
USERDOMAIN                     DELL
USERDOMAIN_ROAMINGPROFILE      DELL
USERNAME                       eric
USERPROFILE                    C:\Users\eric
VCPKG_DEFAULT_TRIPLET          x64-windows
VK_SDK_PATH                    C:\dev\VulkanSDK\1.4.313.0
VTK_DIR                        c:\dev\VTK\lib\cmake\vtk-9.4\
VTUNE_PROFILER_2025_DIR        C:\Program Files (x86)\Intel\oneAPI\vtune\2025.0
VULKAN_SDK                     C:\dev\VulkanSDK\1.4.313.0
windir                         C:\WINDOWS
WIX                            c:\Users\eric\.dotnet\tools\
ZES_ENABLE_SYSMAN              1
ZLIB_DIR                       c:\dev\zlib\lib\cmake\zlib\
ZLIB_ROOT                      c:\dev\zlib\
zstd_DIR                       c:\dev\zstd\lib\cmake\zstd\
```

## Simple Example

### main.cpp

```cpp
#include <expat.h>
#include <stdio.h>
#include <string.h>
#include <fstream>
#include <vector>

#ifdef XML_LARGE_SIZE
#define XML_FMT_INT_MOD "ll"
#else
#define XML_FMT_INT_MOD "l"
#endif

// 元素开始回调函数
static void XMLCALL startElement(void *userData, const XML_Char *name, const XML_Char **atts) {
    printf("Root element: %s\n", name);
    XML_Parser parser = (XML_Parser)userData; // 移除 *
    XML_StopParser(parser,0);
}

int main(int argc, char *argv[]) {
    if (argc != 2) {
        fprintf(stderr, "Usage: %s <xml_file>\n", argv[0]);
        return 1;
    }

    // 读取 XML 文件
    std::ifstream file(argv[1], std::ios::binary | std::ios::ate);
    if (!file) {
        fprintf(stderr, "Failed to open file: %s\n", argv[1]);
        return 1;
    }

    std::streamsize size = file.tellg();
    file.seekg(0, std::ios::beg);
    std::vector<char> buffer(size);
    if (!file.read(buffer.data(), size)) {
        fprintf(stderr, "Failed to read file: %s\n", argv[1]);
        return 1;
    }
    file.close();

    // 创建 XML 解析器
    XML_Parser parser = XML_ParserCreate(NULL);
    if (!parser) {
        fprintf(stderr, "Failed to create XML parser\n");
        return 1;
    }

    // 设置回调函数
    XML_SetUserData(parser, parser);
    XML_SetElementHandler(parser, startElement, NULL);

    // 解析 XML 数据
    if (XML_Parse(parser, buffer.data(), static_cast<int>(buffer.size()), 1) == XML_STATUS_ERROR) {
        fprintf(stderr, "Parse error at line %" XML_FMT_INT_MOD "u: %s\n",
            XML_GetCurrentLineNumber(parser), XML_ErrorString(XML_GetErrorCode(parser)));
        XML_ParserFree(parser);
        return 1;
    }

    XML_ParserFree(parser);
    printf("XML parsed successfully\n");
    return 0;
}
```

### CMakeLists.txt
```cmake
cmake_minimum_required(VERSION 3.12)
project(ExpatExample CXX)

find_package(EXPAT REQUIRED CONFIG)

get_directory_property( my_import_targets DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} IMPORTED_TARGETS )

message( STATUS "my_import_targets=${my_import_targets}" )

# 验证查找结果
message(STATUS "EXPAT_FOUND: ${EXPAT_FOUND}")
message(STATUS "EXPAT_INCLUDE_DIR: ${EXPAT_INCLUDE_DIR}")
message(STATUS "EXPAT_LIBRARIES: ${EXPAT_LIBRARIES}")
message(STATUS "haha+++++++++++++++++++++++++++++")

set( mytarget expat::expat )

get_property(MY_IMPLIB_RELEASE TARGET ${mytarget} PROPERTY IMPORTED_IMPLIB_RELEASE )
get_property(MY_LOCATION_RELEASE TARGET ${mytarget} PROPERTY IMPORTED_LOCATION_RELEASE )
message(STATUS "MY_IMPLIB_RELEASE: ${MY_IMPLIB_RELEASE}")
message(STATUS "MY_LOCATION_RELEASE: ${MY_LOCATION_RELEASE}")

# 添加可执行文件
add_executable(expat_example main.cpp)

target_link_libraries(expat_example PRIVATE expat::expat)
```

```
PS D:\work\libexpat_work\simple\01a\build> cmake ..
-- Building for: Visual Studio 17 2022
-- Selecting Windows SDK version 10.0.22621.0 to target Windows 10.0.26100.
-- The CXX compiler identification is MSVC 19.43.34810.0
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Check for working CXX compiler: C:/Program Files/Microsoft Visual Studio/2022/Community/VC/Tools/MSVC/14.43.34808/bin/Hostx64/x64/cl.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- my_import_targets=expat::expat
-- EXPAT_FOUND: 1
-- EXPAT_INCLUDE_DIR:
-- EXPAT_LIBRARIES:
-- haha+++++++++++++++++++++++++++++
-- MY_IMPLIB_RELEASE: C:/dev/expat/lib/libexpat.lib
-- MY_LOCATION_RELEASE: C:/dev/expat/bin/libexpat.dll
-- Configuring done (3.2s)
-- Generating done (0.0s)
-- Build files have been written to: D:/work/libexpat_work/simple/01a/build
PS D:\work\libexpat_work\simple\01a\build> cmake --build .
适用于 .NET Framework MSBuild 版本 17.13.26+f3741e9cf

  1>Checking Build System
  Building Custom Rule D:/work/libexpat_work/simple/01a/CMakeLists.txt
  main.cpp
D:\work\libexpat_work\simple\01a\main.cpp(1,1): warning C4819: 该文件包含不能在当前代码页(936)中表示的字符。请将该文件保存为 Unicode 格式以防止数据丢失 [D:\
work\libexpat_work\simple\01a\build\expat_example.vcxproj]
  expat_example.vcxproj -> D:\work\libexpat_work\simple\01a\build\Debug\expat_example.exe
  Building Custom Rule D:/work/libexpat_work/simple/01a/CMakeLists.txt
PS D:\work\libexpat_work\simple\01a\build> .\Debug\expat_example.exe
Usage: D:\work\libexpat_work\simple\01a\build\Debug\expat_example.exe <xml_file>
```


```
cmake -DCMAKE_FIND_DEBUG_MODE=TRUE ..
```


```
  The internally managed CMAKE_FIND_PACKAGE_REDIRECTS_DIR.

    D:/work/libexpat_work/simple/01d/build/CMakeFiles/pkgRedirects

  <PackageName>_ROOT CMake variable [CMAKE_FIND_USE_PACKAGE_ROOT_PATH].

    none

  CMAKE_PREFIX_PATH variable [CMAKE_FIND_USE_CMAKE_PATH].

    none

  CMAKE_FRAMEWORK_PATH and CMAKE_APPBUNDLE_PATH variables
  [CMAKE_FIND_USE_CMAKE_PATH].

    none

  Env variable EXPAT_DIR [CMAKE_FIND_USE_CMAKE_ENVIRONMENT_PATH].

    C:/dev/expat/lib/cmake/expat-2.7.1

  CMAKE_PREFIX_PATH env variable [CMAKE_FIND_USE_CMAKE_ENVIRONMENT_PATH].

  CMAKE_FRAMEWORK_PATH and CMAKE_APPBUNDLE_PATH env variables
  [CMAKE_FIND_USE_CMAKE_ENVIRONMENT_PATH].

  Paths specified by the find_package HINTS option.

    none
```


```
    D:/work/libexpat_work/simple/01d/build/CMakeFiles/pkgRedirects/EXPATConfig.cmake
    D:/work/libexpat_work/simple/01d/build/CMakeFiles/pkgRedirects/expat-config.cmake
    C:/dev/expat/lib/cmake/expat-2.7.1/EXPATConfig.cmake
    C:/dev/expat/lib/cmake/expat-2.7.1/expat-config.cmake

  The file was found at

    C:/dev/expat/lib/cmake/expat-2.7.1/expat-config.cmake



-- my_import_targets=expat::expat
-- EXPAT_FOUND: 1
-- EXPAT_INCLUDE_DIR:
-- EXPAT_LIBRARIES:
-- haha+++++++++++++++++++++++++++++
-- MY_IMPLIB_RELEASE: C:/dev/expat/lib/libexpat.lib
-- MY_LOCATION_RELEASE: C:/dev/expat/bin/libexpat.dll
-- EXPAT_INCLUDE_DIRS: C:/dev/expat/include
-- EXPAT_LINK_LIBRARIES: EXPAT_LINK_LIBRARIES-NOTFOUND
-- Target LOCATION: LOCATION-NOTFOUND
-- CMAKE_PREFIX_PATH:
-- CMAKE_MODULE_PATH:
-- CMAKE_SYSTEM_PREFIX_PATH: C:/Program Files;C:/Program Files (x86);C:/Program Files/CMake;C:/Program Files (x86)/ExpatExample
-- Configuring done (3.4s)
-- Generating done (0.0s)
-- Build files have been written to: D:/work/libexpat_work/simple/01d/build
```

```
    C:/msys64/mingw64/bin/pkg-config.bat.com
    C:/msys64/mingw64/bin/pkg-config.bat.exe
    C:/msys64/mingw64/bin/pkg-config.bat
    C:/msys64/mingw64/bin/pkg-config.com

  The item was found at

    C:/msys64/mingw64/bin/pkg-config.exe

Call Stack (most recent call first):
  C:/Program Files/CMake/share/cmake-4.0/Modules/FindEXPAT.cmake:51 (find_package)
  CMakeLists.txt:5 (find_package)


CMake Debug Log at C:/Program Files/CMake/share/cmake-4.0/Modules/FindEXPAT.cmake:51 (find_package):
  find_package considered the following paths for FindPkgConfig.cmake:

  The file was found at

    C:/Program Files/CMake/share/cmake-4.0/Modules/FindPkgConfig.cmake

Call Stack (most recent call first):
  CMakeLists.txt:5 (find_package)


CMake Debug Log at C:/Program Files/CMake/share/cmake-4.0/Modules/FindPkgConfig.cmake:309 (find_library):
  find_library called with the following settings:

    VAR: pkgcfg_lib_PC_EXPAT_expat
    NAMES: "expat"
    Documentation: Path to a library.
    Framework
      Only Search Frameworks: 0
      Search Frameworks Last: 0
      Search Frameworks First: 0
    AppBundle
      Only Search AppBundle: 0
      Search AppBundle Last: 0
      Search AppBundle First: 0
    NO_DEFAULT_PATH Enabled

  find_library considered the following locations:

  The item was found at

    C:/msys64/mingw64/lib/libexpat.a
	
-- my_import_targets=EXPAT::EXPAT
-- EXPAT_FOUND: TRUE
-- EXPAT_INCLUDE_DIR: C:/msys64/mingw64/include
-- EXPAT_LIBRARIES: C:/msys64/mingw64/lib/libexpat.a
-- haha+++++++++++++++++++++++++++++
-- MY_IMPLIB_RELEASE:
-- MY_LOCATION_RELEASE: C:/msys64/mingw64/lib/libexpat.a
-- EXPAT_INCLUDE_DIRS: C:/msys64/mingw64/include
-- EXPAT_LINK_LIBRARIES: EXPAT_LINK_LIBRARIES-NOTFOUND
-- Target LOCATION: LOCATION-NOTFOUND
-- CMAKE_PREFIX_PATH:
-- CMAKE_MODULE_PATH:
-- CMAKE_SYSTEM_PREFIX_PATH: C:/Program Files;C:/Program Files (x86);C:/Program Files/CMake;C:/Program Files (x86)/ExpatExample
-- Configuring done (3.7s)
-- Generating done (0.0s)
-- Build files have been written to: D:/work/libexpat_work/simple/01d/build
```

```
c:/msys64/mingw64/bin/
```